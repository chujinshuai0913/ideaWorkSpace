!function(a,b,c,d){"use strict";function h(a,b){function c(a,b){return b&&a?b.toLowerCase().indexOf(a.toLowerCase())>=0:!1}return c(a,b.find(".node-text").text())||c(a,b.attr("href"))}function i(a){var b,c,d;return a.show(),b=a.closest(".tree-group"),!b||b.length<=0?!1:(c=b.closest(".tree-node"),!c||c.length<=0?!1:(d=c.find(".node-wrap").eq(0),d.show(),i(d),void 0))}var g,j,e="treeView",f={};f.settings={data:"",getDataUrl:"",nodeIcon:"fa fa-list",nodeIconType:"",iconCollapse:"",iconExpand:"",iconEmpty:"icon-empty",showIcon:!0,collapseOnIcon:!1,injectStyle:!0,classPrefix:"heanes-tree-view",style:{top:{bgColor:"",color:""},topActive:{bgColor:"#eee",color:"#333"},topHover:{bgColor:"#eee",color:"#333"},left:{bgColor:"",color:""},leftSelected:{bgColor:"#eee",color:"#333"},leftHover:{bgColor:"#666",color:"#fff"},leftNodeExpanded:{bgColor:"#eee",color:""}},nodeDefaultState:{selected:!1,expanded:!0,disabled:!1,checked:!1},enableLink:!1,showSingleNodeIcon:!0,enableTopSwitch:!1,topSwitcherTarget:"",showTopNavIcon:!0,leftTreeHandler:{contract:{enable:!0,indentLeftDelay:1e3},collapseAll:{enable:!0},expandAll:{enable:!0}},enableTreeSearch:!1,treeSearchPlaceholder:"search",multiSelect:!1,onNodeClick:d,onNodeSelected:d,onNodeCollapsed:d,onNodeExpanded:d,onTopSwitch:d,onLeftTreeContract:d,some:""},f.node={text:"",nodeIcon:"fa fa-list",href:"",iconSelected:"",selectable:!0,state:{selected:!1,expanded:!0,disabled:!1,checked:!1},target:"",nodes:[]},f.options={silent:!1,ignoreChildren:!1},g=function(b,c){return this.$element=a(b),this.elementId=b.id,this.styleId=this.elementId+"-style",this.init(c),{options:this.options,init:a.proxy(this.init,this),remove:a.proxy(this.remove,this),getNode:a.proxy(this.getNode,this),setNode:a.proxy(this.setNode,this),addNode:a.proxy(this.addNode,this),removeNode:a.proxy(this.removeNode,this),collapseAll:a.proxy(this.collapseAll,this),collapseNode:a.proxy(this.collapseNode,this),expandAll:a.proxy(this.expandAll,this),expandNode:a.proxy(this.expandNode,this),toggleExpandedState:a.proxy(this.toggleExpandedState,this),selectNode:a.proxy(this.selectNode,this),clickNode:a.proxy(this.clickNode,this),test:a.proxy(this.test,this)}},g.prototype.init=function(b){this.tree=[],this.nodes=[],b.data&&("string"==typeof b.data&&(b.data=a.parseJSON(b.data)),this.tree=a.extend(!0,[],b.data),delete b.data),this.options=a.extend(!0,{},f.settings,b),this.options.enableTopSwitch&&this.options.topSwitcherTarget&&(this.$treeTopTarget=this.options.topSwitcherTarget,this.$treeTopTarget&&this.$treeTopTarget.length>0&&(this.enableTopSwitch=!0)),this.topExpandNode=d,this.convertToStandardTree(this.tree),this.setInitialStates({nodes:this.tree},0),this.render(),this.subscribeEvents()},g.prototype.setInitialStates=function(b,c){var e,f;b.nodes&&(c+=1,e=b,f=this,a.each(b.nodes,function(a,b){b.nodeId=f.nodes.length,b.parentId=e.nodeId,b.nodeIcon=b.nodeIcon||f.options.nodeIcon,b.state=b.state||{},1===c&&b.state.expanded&&f.topExpandNode===d&&(f.topExpandNode=a),f.nodes.push(b),b.nodes&&f.setInitialStates(b,c)}))},g.prototype.convertToStandardTree=function(b){if(b){var c=this;return a.each(b,function(d,e){e.state=a.extend(!0,{},f.node.state,c.options.nodeDefaultState,e.state),b[d]=a.extend(!0,{},f.node,e),e.nodes&&e.nodes.length>0&&(b[d].nodes=c.convertToStandardTree(e.nodes))}),b}},g.prototype.subscribeEvents=function(){this.$element.on("click",a.proxy(this.clickHandler,this)),this.enableTopSwitch&&this.$treeTopTarget.on("click",a.proxy(this.switchHandler,this)),"function"==typeof this.options.onNodeClick&&this.$element.on("nodeClick",this.options.onNodeClick),"function"==typeof this.options.onNodeSelected&&this.$element.on("nodeSelected",this.options.onNodeSelected),"function"==typeof this.options.onTopSwitch&&this.$element.on("topSwitch",this.options.onTopSwitch),"function"==typeof this.options.onLeftTreeContract&&this.$element.on("leftTreeContract",this.options.onLeftTreeContract)},g.prototype.switchHandler=function(b){var c,d;b.preventDefault(),c=a(b.target),d=this.findNodeDom(c),d&&0!==d.length&&(d.parent().children().removeClass("active"),d.addClass("active"),this.$treeListWrap.children().removeClass("active").eq(d.index()).addClass("active"),this.$element.trigger("topSwitch",[a.extend(!0,{})]))},g.prototype.clickHandler=function(b){var c,d,e,g,h,i,j,k;return this.options.enableLink&&b.preventDefault(),c=a(b.target),this.options.leftTreeHandler.contract.enable&&(d=c.hasClass("handle-contract")?c:c.closest(".handle-contract"),d&&d.length>0)?(e=this.findLapDom(c),e&&this.toggleContract(e,f.options),this):(g=c.hasClass("handle-contract")?c:c.closest(".tree-node"),!g||g.length<=0?this:(h=this.findNodeDom(c),i=this.findNode(h),i&&!i.state.disabled&&(j=[],k=h.find("i.icon"),k.each(function(b,c){a(c).attr("class")?j=j.concat(a(c).attr("class").split(" ")):null}),a.unique(j),-1!==j.indexOf("node-collapse-expand-icon")?(this.toggleExpandedState(i,f.options),this.toggleExpandedStyle(i,h,f.options,b)):(this.nodeClick(i,h,f.options),i.selectable?(this.findNodeDomAll().find(".node-wrap").removeClass("selected"),h.find(".node-wrap").toggleClass("selected"),this.toggleSelectedState(i,f.options)):this.toggleExpandedState(i,f.options))),void 0))},g.prototype.bindCollapseAllHandle=function(){var a=this.$handleCollapseAll,b=this;a.on("click",function(){var a=b.$treeListWrap.find(".tree-group.active"),c=a.find(".tree-node.expand,.tree-node.collapse"),d=c.find(".node-collapse-expand-icon");return c.removeClass("expand").addClass("collapse"),d.removeClass("triangle-bottom").addClass("triangle-right"),b})},g.prototype.bindExpandAllHandle=function(){var a=this.$handleExpandAll,b=this;a.on("click",function(){var a=b.$treeListWrap.find(".tree-group.active"),c=a.find(".tree-node.expand,.tree-node.collapse"),d=c.find(".node-collapse-expand-icon");return c.removeClass("collapse").addClass("expand"),d.removeClass("triangle-right").addClass("triangle-bottom"),b})},g.prototype.searchTree=function(){var c,d,e,b=this.$treeSearch.find('input[type="text"]').eq(0);b.attr("placeholder",this.options.treeSearchPlaceholder),c=this.$treeListWrap.find(".tree-group"),d=0,a.each(c,function(b,c){return a(c).hasClass("active")?(d=b,!1):void 0}),e=this.$treeListWrap.find(".node-wrap"),b.on("input",function(){var g=b.val();return""===g?(e.show(),c.removeClass("active"),c.eq(d).addClass("active"),!1):(e.hide(),c.addClass("active"),a.each(e,function(b,c){var d=a(c);h(g,a(c))&&i(d)}),void 0)})},g.prototype.toggleContract=function(a){a&&0!==a.length&&(this.$treeLeftWrap.toggleClass("contracted"),this.$element.trigger("leftTreeContract"))},g.prototype.toggleExpandedState=function(a,b){a&&this.setExpandedState(a,!a.state.expanded,b)},g.prototype.toggleExpandedStyle=function(a,b,c,d){b&&this.setExpandedStyle(a,b,!a.state.expanded,c,d)},g.prototype.setExpandedStyle=function(b,c,d,e,f){if(d!==b.state.expanded){var g=this;c.hasClass("collapse")?c.removeClass("collapse").addClass("expand"):c.hasClass("expand")?c.removeClass("expand").addClass("collapse"):c.addClass("collapse"),a(f.target),c.children(".node-wrap").find(".node-collapse-expand-icon").toggleClass(function(){return a(this).hasClass(g.options.iconCollapse)?(a(this).removeClass(g.options.iconCollapse),g.options.iconExpand):(a(this).removeClass(g.options.iconExpand),g.options.iconCollapse)})}},g.prototype.setExpandedState=function(b,c,d){c!==b.state.expanded&&(c&&b.nodes?b.state.expanded=!0:c||(b.state.expanded=!1,d.silent||this.$element.trigger("nodeCollapsed",a.extend(!0,{},b)),b.nodes&&!d.ignoreChildren&&a.each(b.nodes,a.proxy(function(a,b){this.setExpandedState(b,!1,d)},this))))},g.prototype.findNode=function(a){var b,c,e,g;return b=a.attr("data-nodeId")?a:this.findNodeDom(a),c=b.attr("data-nodeId"),e=this.nodes[c],e||(e=f.node,g=a.find("a"),e.href=g.attr("href"),e.text=g.find(".node-text").text(),e.icon=g.find(".node-icon").attr("class"),e.href&&e.text&&""!==e.text)?e:(console.log("Error: node does not exist"),d)},g.prototype.findNodes=function(b,c,d){c=c||"g",d=d||"text";var e=this;return a.grep(this.nodes,function(a){var f=e.getNodeValue(a,d);return"string"==typeof f?f.match(new RegExp(b,c)):void 0})},g.prototype.findNodeDom=function(a){var b=a.hasClass("handle-contract")?a:a.closest(".tree-node");return b&&0!==b.length||console.log("Error: nodeDom does not exist"),b},g.prototype.findNodeDomAll=function(a){var b=d;switch(a=a||"left"){case"left":b=this.$treeListWrap.find("li.tree-node");break;case"top":b=this.$treeTopWrap.find("li.tree-node")}return!b||0===b.length,b},g.prototype.getNodeValue=function(a,b){var e,f,c=b.indexOf(".");return c>0?(e=a[b.substring(0,c)],f=b.substring(c+1,b.length),this.getNodeValue(e,f)):a.hasOwnProperty(b)?a[b].toString():d},g.prototype.findLapDom=function(a){var b=a.hasClass("handle-contract")?a:a.closest(".handle-contract");return b&&0!==b.length?b:(console.log("Error: lapDom does not exist"),null)},g.prototype.getIsExpanded=function(a){return a.state!==d?a.state.expanded!==d&&a.state.expanded:!1},g.prototype.render=function(){this.initialized||(this.injectStyle(),this.$leftTreeHandle=a(this.template.leftTreeHandle),this.$handleContractLeftTree="",this.options.leftTreeHandler.contract.enable&&(this.$handleContractLeftTree=a(this.template.handleContractLeftTree)),this.options.leftTreeHandler.collapseAll.enable&&(this.$handleCollapseAll="",this.$handleCollapseAll=a(this.template.handleCollapseAll)),this.options.leftTreeHandler.expandAll.enable&&(this.$handleExpandAll="",this.$handleExpandAll=a(this.template.handleExpandAll)),this.options.enableTreeSearch&&(this.$treeSearch=a(this.template.treeSearch)),this.$treeLeftWrap=a(this.template.treeLeftWrap),this.$treeListWrap=a(this.template.treeListWrap),this.initialized=!0),this.enableTopSwitch&&(this.$treeTopWrap=a(this.template.treeTopWrap),this.$treeTop=a(this.template.treeTop),this.$treeTopTarget.empty().append(this.$treeTopWrap.empty().append(this.$treeTop.empty())),this.$treeListWrap.addClass("switch")),this.$element.empty().append(this.$treeLeftWrap.append(this.$leftTreeHandle.append(this.$handleCollapseAll).append(this.$handleExpandAll).append(this.$handleContractLeftTree)).append(this.$treeSearch).append(this.$treeListWrap.empty())),this.buildTree(this.tree),this.$treeListWrap.children().eq(this.topExpandNode).addClass("active"),this.options.enableTreeSearch&&this.searchTree(),this.options.leftTreeHandler.collapseAll.enable&&this.bindCollapseAllHandle(),this.options.leftTreeHandler.expandAll.enable&&this.bindExpandAllHandle()},g.prototype.buildTree=function(b,c,e){var f,g;if(b)return c===d?c=1:c++,f=this,f.enableTopSwitch&&c--,e=e||!1,e&&c++,g=1===c?"":a(f.template.treeLeftGroup),e&&(g=a(f.template.treeLeftGroup)),a.each(b,function(b,h){var i,j,k,l,m,n;if(1>=c&&!e?g=a(f.template.treeLeftGroup):null,i=a(f.template.node).attr("data-nodeId",h.nodeId),j=a(f.template.nodeWrap),f.options.enableLink&&(j=a(f.template.nodeLink),j.attr("href",h.href),h.target!==d&&j.attr("target",h.target)),0===c)f.options.showIcon&&f.options.showTopNavIcon&&(k=["node-icon"],k.push(h.nodeIcon||f.options.nodeIcon),j.append(a(f.template.icon).addClass(k.join(" ")))),f.topExpandNode===b&&i.addClass("active"),j.append(a(f.template.nodeText).append(h.text)),f.$treeTop.append(i.append(j)),f.$treeListWrap.append(f.buildTree(h.nodes,c,!0));else{for(l=0;c-1>l;l++)j.append(f.template.indent);m=[],h.nodes&&h.nodes.length>0?(m.push("node-collapse-expand-icon"),h.state.expanded?(m.push("expand"),m.push(f.options.iconExpand),i.addClass("expand")):(m.push("collapse"),m.push(f.options.iconCollapse),i.addClass("collapse")),j.append(a(f.template.icon).addClass(m.join(" ")))):m.push(f.options.iconEmpty),f.options.showIcon&&(1===c||f.options.showSingleNodeIcon||h.nodes&&h.nodes.length>0)&&(n=["node-icon"],n.push(h.nodeIcon||f.options.nodeIcon),j.append(a(f.template.icon).addClass(n.join(" ")))),j.append(a(f.template.nodeText).append(h.text)),g.append(i.append(j)),h.nodes&&h.nodes.length>0&&i.append(f.buildTree(h.nodes,c,e)),1!==c||e||(console.log("append treeLeft"),f.$treeListWrap.append(g))}}),g},g.prototype.collapseNode=function(){},g.prototype.expandNode=function(){},g.prototype.nodeClick=function(b,c){b&&this.$element.trigger("nodeClick",[a.extend(!0,{},b),c])},g.prototype.toggleSelectedState=function(a,b){a&&this.setSelectedState(a,!a.state.selected,b)},g.prototype.setSelectedState=function(b,c,d){c!==b.state.selected&&(c?(this.options.multiSelect||a.each(this.findNodes("true","g","state.selected"),a.proxy(function(a,b){this.setSelectedState(b,!1,d)},this)),b.state.selected=!0,d.silent||this.$element.trigger("nodeSelected",a.extend(!0,{},b))):(b.state.selected=!1,d.silent||this.$element.trigger("nodeUnselected",a.extend(!0,{},b))))},g.prototype.toggleNodeSelected=function(b,c){this.forEachIdentifier(b,c,a.proxy(function(a,b){this.toggleSelectedState(a,b)},this))},g.prototype.forEachIdentifier=function(b,c,d){c=a.extend({},f.options,c),b instanceof Array||(b=[b]),a.each(b,a.proxy(function(a,b){d(this.identifyNode(b),c)},this))},g.prototype.identifyNode=function(a){return"number"==typeof a?this.nodes[a]:a},g.prototype.template={treeTopWrap:'<div class="tree-top-wrap"></div>',treeTop:'<ul class="tree-top-list"></ul>',treeLeftWrap:'<div class="tree-left-wrap"></div>',treeListWrap:'<div class="tree-list-wrap"></div>',treeLeftGroupWrap:'<div class="tree-group-wrap"></div>',treeLeftGroup:'<ul class="tree-group"></ul>',nodeWrap:'<span class="node-wrap"></span>',nodeLink:'<a class="node-wrap"></a>',node:'<li class="tree-node"></li>',link:'<a href="javascript:;" class="node-wrap"></a>',nodeText:'<span class="node-text"></span>',indent:'<span class="indent"></span>',icon:'<i class="icon"></i>',badge:'<span class="badge"></span>',leftTreeHandle:'<div class="tree-left-handle"></div>',handleContractLeftTree:'<span class="left-tree-handle-btn handle-contract" title="收缩/展开"><i class="handle-icon fa fa-exchange"></i></span>',handleCollapseAll:'<span class="left-tree-handle-btn handle-collapse-all" title="一键折叠全部"><i class="handle-icon fa fa-compress"></i></span>',handleExpandAll:'<span class="left-tree-handle-btn handle-expand-all" title="一键展开全部"><i class="handle-icon fa fa-expand"></i></span>',treeSearch:'<div class="tree-search"><input type="text" class="tree-search-input" placeholder="search" /></div>',collapseAllHandle:'<div class="collapse-all-handle"><span class="collapse-all-handle-btn collapsed" title="一键折叠/展开全部"><i class="handle-icon fa fa-compress"></i></span></div>'},g.prototype.buildStyle=function(){var a="";return this.options.style.top.bgColor&&(a+=".tree-top-wrap{background-color:"+this.options.style.top.bgColor+"}"),this.options.style.top.color&&(a+=".tree-top-wrap{color:"+this.options.style.top.color+"}"),this.options.style.topActive.bgColor&&(a+=".tree-top-wrap .tree-top-list .tree-node.active{background-color:"+this.options.style.topActive.bgColor+"}"),this.options.style.topActive.color&&(a+=".tree-top-wrap .tree-top-list .tree-node.active{color:"+this.options.style.topActive.color+"}"),this.options.style.topHover.bgColor&&(a+=".tree-top-wrap .tree-top-list .tree-node:hover{background-color:"+this.options.style.topHover.bgColor+"}"),this.options.style.topHover.color&&(a+=".tree-top-wrap .tree-top-list .tree-node:hover{color:"+this.options.style.topHover.color+"}"),this.options.style.left.bgColor&&(a+=".tree-list-wrap{background-color:"+this.options.style.left.bgColor+"}"),this.options.style.left.color&&(a+=".tree-list-wrap{color:"+this.options.style.left.color+"}"),this.options.style.leftSelected.bgColor&&(a+=".tree-list-wrap .tree-node .node-wrap.selected{background-color:"+this.options.style.leftSelected.bgColor+"}"),this.options.style.leftSelected.color&&(a+=".tree-list-wrap .tree-node .node-wrap.selected{color:"+this.options.style.leftSelected.color+"}"),this.options.style.leftHover.bgColor&&(a+=".tree-list-wrap .tree-node .node-wrap:hover{background-color:"+this.options.style.leftHover.bgColor+"}"),this.options.style.leftHover.color&&(a+=".tree-list-wrap .tree-node .node-wrap:hover{color:"+this.options.style.leftHover.color+"}"),this.options.style.leftNodeExpanded.bgColor&&(a+=".tree-list-wrap .tree-group li.expand{background-color:"+this.options.style.leftNodeExpanded.bgColor+"}"),this.options.style.leftNodeExpanded.color&&(a+=".tree-list-wrap .tree-group li.expand{color:"+this.options.style.leftNodeExpanded.color+"}"),a},g.prototype.injectStyle=function(){this.options.injectStyle&&!c.getElementById(this.styleId)&&a('<style type="text/css" id="'+this.styleId+'"> '+this.buildStyle()+" </style>").appendTo("head")},g.prototype.getNode=function(a){return this.nodes[a]},g.prototype.setNode=function(a){this.nodes[a.id]=a},g.prototype.addNode=function(a){this.nodes[a.id]=a},g.prototype.removeNode=function(a){this.nodes[a]=d},g.prototype.getParent=function(a){var b=this.identifyNode(a);return this.nodes[b.parentId]},g.prototype.getNodeListData=function(b,c,d){var g,e=b||"";if(""===e)return null;switch(g=this,c){case"json":a.getJSON(e,function(a){f.settings.data=a,g.init(f,d)});break;case"get":return a.ajax(),null}},j=function(a){b.console&&b.console.error(a)},a.fn[e]=function(b,c){var d;return this.each(function(){var f=a.data(this,e);"string"==typeof b?f?a.isFunction(f[b])&&"_"!==b.charAt(0)?(c instanceof Array||(c=[c]),d=f[b].apply(f,c)):j("No such method : "+b):j("Not initialized, can not call method : "+b):"boolean"==typeof b?d=f:a.data(this,e,new g(this,a.extend(!0,{},b)))}),d||this}}(jQuery,window,document);